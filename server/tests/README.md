# ポケモンバトルシステム 統合テスト

このディレクトリには、ポケモンバトルシステムの統合テストファイルが含まれています。

## テストファイル

### `battle-system.test.ts`
ポケモンバトルシステムの統合テストファイルです。以下の機能をテストします：

- **攻撃ハンドラー**: 物理攻撃・特殊攻撃のダメージ計算
- **状態異常ハンドラー**: 毒・麻痺・眠り・火傷・凍り・混乱の処理
- **交代ハンドラー**: ポケモンの交代処理
- **戦闘モード**: fightMode, switchMode, getMode
- **戦闘結果**: バトル終了・経験値・捕獲処理
- **バトルシミュレーション**: 複数ターンにわたる総合的な戦闘テスト

## テスト実行方法

### メインテスト実行
```bash
npm run test:battle

### 直接実行
```bash
npx ts-node tests/advanced-battle.test.ts
```
npx ts-node tests/battle-system.test.ts
```

## テスト内容詳細

### 1. 攻撃ハンドラーテスト
- 物理攻撃のダメージ計算
- 特殊攻撃のダメージ計算
- 攻撃後のHP変化確認

### 2. 状態異常ハンドラーテスト
#### 基本テスト
- 毒状態のダメージ処理
- 麻痺状態の行動制限

#### 詳細テスト（複数ターン検証）
- **毒状態**: 継続ダメージの確認
- **麻痺状態**: 行動可能率の統計検証（理論値25%行動不能）
- **眠り状態**: 自然回復の確認
- **火傷状態**: 継続ダメージの確認
- **凍り状態**: 自然回復の確認
- **混乱状態**: 自傷ダメージと行動不能率の統計検証
- **状態異常治癒**: 自然回復メカニズムの検証

### 3. 交代ハンドラーテスト
- 正常な交代処理の確認
- 交代不可能ケース（全員瀕死）の判定

### 4. 戦闘モードテスト
- **fightMode**: 戦闘コマンドの実行
- **switchMode**: ポケモン交代処理
- **getMode**: ポケモン捕獲処理

### 5. 戦闘結果テスト
- バトル終了判定
- 経験値獲得処理
- ポケモン捕獲結果
- ターン数カウント

### 6. バトルシミュレーション
- 複数のバトルシナリオを実行
- 様々なポケモンの組み合わせでの戦闘
- 複雑な戦闘状況での総合的な動作検証

## 実行時間について

このテストは多くの戦闘シミュレーション（状態異常の確率検証など）を含むため、実行に数分かかる場合があります。

## 注意事項

- テストは実際のバトル処理を呼び出すため、関連するサービスやハンドラーが正常に動作する必要があります
- 確率的なテスト（状態異常の発生率など）は統計的な検証を行っているため、稀に期待値から外れる結果が出る可能性があります
- テスト実行中は大量のログが出力されますが、これは正常な動作です

## テスト結果の見方

- ✓ : テスト成功
- ✗ : テスト失敗  
- 📊 : 統計情報表示
- 🎉 : テスト完了

確率的な処理のテストでは、理論値と実測値の比較が表示されます。
